---
  # YUM repo
  - name: ping Kismatic yum repository
    uri: url="{{ yum_repository_url }}"
    notify:
      - add Kismatic yum repository
      - clean Kismatic yum cache # required to get new versions of packagess
    when: ansible_distribution == 'CentOS' or ansible_distribution == 'Red Hat Enterprise Linux'
    ignore_errors: yes
    register: result
    until: "result.status is defined and result.status == 200"
    retries: 3
    delay: 1
    changed_when: "result.status is defined and result.status == 200"

  # DEB repo
  - name: ping Kismatic deb repository
    uri: url="{{ deb_repository_url }}"
    notify:
      - install apt-transport-https package
      - add Kismatic deb repository
      - add Kismatic deb key
      - apt-get update
    when: ansible_distribution == 'Ubuntu'
    ignore_errors: yes
    register: result
    until: "result.status is defined and result.status == 200"
    retries: 3
    delay: 1
    changed_when: "result.status is defined and result.status == 200"

  - meta: flush_handlers  #Run handlers

  - name: install yum packages
    command: /bin/true
    notify:
      - install etcd yum package
      - install kubernetes master yum package
      - install kubernetes worker yum package
    when: ansible_distribution == 'CentOS' or ansible_distribution == 'Red Hat Enterprise Linux'

  - name: install deb packages
    command: /bin/true
    notify:
      - install etcd deb package
      - install kubernetes master deb package
      - install kubernetes worker deb package
    when: ansible_distribution == 'Ubuntu'
