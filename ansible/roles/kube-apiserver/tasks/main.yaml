---
  - name: download kube-apiserver image
    command: docker pull gcr.io/google-containers/kube-apiserver-amd64:{{ kubernetes_version }}

  - name: copy kube-apiserver.yaml manifest
    template:
      src: kube-apiserver.yaml
      dest: /etc/kubernetes/manifests/kube-apiserver.yaml
      owner: "{{ kubernetes_owner }}"
      group: "{{ kubernetes_group }}"
      mode: "{{ kubernetes_service_mode }}"

  # enable below code and modify manifest file with different ports if need to debug kube-apiserver
  # - name: get temp API-server
  #   get_url:
  #     url: https://storage.googleapis.com/kubernetes-release/release/{{ kubernetes_version }}/bin/linux/amd64/kube-apiserver
  #     dest: /usr/bin/kube-apiserver
  #     mode: 0770

  # - name: copy debug kube-apiserver.service to remote
  #   template:
  #     src: kube-apiserver.service.debug
  #     dest: "{{ kubernetes_service_dir }}/kube-apiserver.service"
  #     owner: "{{ kubernetes_owner }}"
  #     group: "{{ kubernetes_group }}"
  #     mode: "{{ kubernetes_service_mode }}"
  #   notify:
  #     - reload services
  #     - enable kube-apiserver
  #     - restart kube-apiserver service
  #     - verify kube-apiserver is running

  # # force_apiserver_restart=true to force restart
  # - name: force restart kube-apiserver
  #   command: /bin/true
  #   notify:
  #     - enable kube-apiserver
  #     - restart kube-apiserver service
  #     - verify kube-apiserver is running
  #   when: force_apiserver_restart is defined and force_apiserver_restart|bool == true
